CREATE OR REPLACE FUNCTION hitung_jumlah_tersediaMH()
RETURNS trigger AS
$$
    BEGIN
        IF (TG_OP = 'INSERT') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia + NEW.jumlah
            WHERE nama = NEW.namamenu;

        ELSEIF (TG_OP = 'DELETE') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia - OLD.jumlah
            WHERE nama= OLD.namamenu;

        ELSEIF (TG_OP = 'UPDATE') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia + NEW.jumlah
            WHERE nama = NEW.namamenu;
            UPDATE MENU SET jumlahtersedia = jumlahtersedia - OLD.jumlah
            WHERE nama = OLD.namamenu;
        END IF;
            RETURN NEW;
    END;
$$
LANGUAGE plpgsql;

CREATE TRIGGER jumlah_tersediaMH
AFTER INSERT OR DELETE OR UPDATE
ON MENU_HARIAN FOR EACH ROW
EXECUTE PROCEDURE hitung_jumlah_tersediaMH();

CREATE OR REPLACE FUNCTION hitung_jumlah_tersediaPMH()
RETURNS trigger AS
$$
    BEGIN
        IF (TG_OP = 'INSERT') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia - NEW.jumlah
            WHERE nama = NEW.namamenu;

        ELSEIF (TG_OP = 'DELETE') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia + OLD.jumlah
            WHERE nama= OLD.namamenu;

        ELSEIF (TG_OP = 'UPDATE') THEN
            UPDATE MENU SET jumlahtersedia = jumlahtersedia - NEW.jumlah
            WHERE nama = NEW.namamenu;
            UPDATE MENU SET jumlahtersedia = jumlahtersedia + OLD.jumlah
            WHERE nama = OLD.namamenu;
        END IF;
            RETURN NEW;
    END;
$$
LANGUAGE plpgsql;

CREATE TRIGGER jumlah_tersediaPMH
AFTER INSERT OR DELETE OR UPDATE
ON PEMESANAN_MENU_HARIAN FOR EACH ROW
EXECUTE PROCEDURE hitung_jumlah_tersediaPMH();